"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAccountById=exports.getAccountByToken=exports.deleteAccountById=exports.deleteAccountByPassword=exports.createAccountByPassword=void 0;const cartUtils_1=require("./cartUtils"),dbToken_1=__importDefault(require("./dbToken")),loginUtils_1=require("./loginUtils"),httpCodes_1=__importDefault(require("../utils/httpCodes")),userUtils_1=require("./userUtils");async function createAccountByPassword(email,password){const user=await(0,userUtils_1.createUserByEmail)(email);await(0,loginUtils_1.createLoginByPassword)(email,password,user);const token=dbToken_1.default.getNew(email);return await dbToken_1.default.save(email,token),user.token=token,{user:user,token:token}}async function deleteAccount(cartId,email,userId){await(0,cartUtils_1.deleteCartById)(cartId),await(0,loginUtils_1.deleteLoginByEmail)(email),await(0,userUtils_1.deleteUserById)(userId)}async function deleteAccountById(userId){const user=await(0,userUtils_1.getUserById)(userId);if(!user){const error=new Error("ERROR: invalid user id");throw error.code=httpCodes_1.default.error.badRequest,error}await deleteAccount(user.cartID,user.email,userId)}async function deleteAccountByPassword(email,password){const user=await(0,userUtils_1.getUserByPassword)(email,password);if(!user){const error=new Error("ERROR: incorrect password");throw error.code=httpCodes_1.default.error.incorrectPassword,error}await deleteAccount(user.cartID,email,user.id)}async function getAccountByToken(email,token){const user=await(0,userUtils_1.getUserByToken)(email,token),account=await getAccountById(user.id);return account&&(account.token=token),account}async function getAccountById(userID){const account=await(0,userUtils_1.getUserById)(userID);return account.cart=await(0,cartUtils_1.getCartById)(account.cartID),account}exports.createAccountByPassword=createAccountByPassword,exports.deleteAccountById=deleteAccountById,exports.deleteAccountByPassword=deleteAccountByPassword,exports.getAccountByToken=getAccountByToken,exports.getAccountById=getAccountById;