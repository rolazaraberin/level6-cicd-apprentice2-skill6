"use strict";var __rest=this&&this.__rest||function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const utilityFunctionsServer_1=require("../utilityFunctionsServer"),utilityFunctions_1=require("../utils/utilityFunctions"),authenticate_1=__importDefault(require("../controllers/authenticate")),database_1=require("../models/database"),inventoryData=createData("inventory");function createData(route){let mainTable;return"cart"===route&&(mainTable="cart"),"inventory"===route&&(mainTable="inventory"),async function(request,response){try{const validValues=(0,utilityFunctionsServer_1.getValidValues)(request.body),tableData=validValues[mainTable],itemData=validValues.item;let itemsTable=tableData.itemsTable;if(!itemsTable||""===itemsTable){const email=request.body.user.email,emailHash=undefined;itemsTable=(0,utilityFunctions_1.hash)(email)}await authenticate_1.default.itemsTable(itemsTable);try{await database_1.knex.table(mainTable).insert(tableData)}catch(dataAlreadyExists){await database_1.knex.table(mainTable).update(tableData)}try{await database_1.knex.table(itemsTable).insert(itemData)}catch(dataAlreadyExists){await database_1.knex.table(itemsTable).update(itemData)}let result={};result[mainTable]=await database_1.knex.table(mainTable).select(),result[itemsTable]=await database_1.knex.table(itemsTable).select(),response.status(200).send(result)}catch(error){response.status(400).send(error.message)}}}async function manualData(request,response){try{const _a=request.body,{table:table}=_a,data=__rest(_a,["table"]);await database_1.knex.insert(data).table(table);const result=await database_1.knex.table(table).select();response.status(200).send(result)}catch(error){response.status(400).send(error.message)}}exports.default={manualData:manualData,inventoryData:inventoryData};